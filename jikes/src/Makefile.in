# $Id$

# This software is subject to the terms of the IBM Jikes Compiler
# License Agreement available at the following URL:
# http://www.ibm.com/research/jikes.
# Copyright (C) 1996, 1998, International Business Machines Corporation
# and others.  All Rights Reserved.
# You must accept the terms of that agreement to use this software.

SHELL=@SHELL@

VPATH		= @srcdir@
top_srcdir	= @top_srcdir@
srcdir		= @srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@

CXX=@CXX@
CXXFLAGS=-I. -I$(srcdir) @CXXFLAGS@
LDFLAGS=@LDFLAGS@
LIBS=@LIBS@

# Handy flags to use with various compilers
# IBM xlC : -O3
# Sun CC : -fast : -ansi, -xs to debug with shared libst
# gcc : -O6 -funroll-loops -fomit-frame-pointer

# Add -DJIKES_DEBUG to get extra debug features!


SYSOBJECTS=@SYSOBJECTS@
EXECUTABLE=jikes@EXEEXT@

STRIP=@STRIP@
ERASE=rm -f
MKDIR=mkdir -p
JIKESPG=@JIKESPG@

#
# You should not need to edit below here
#


all:  $(EXECUTABLE)

clean:
	$(ERASE) $(EXECUTABLE)
	$(ERASE) $(OBJECTS)
	$(ERASE) core
	$(ERASE) gencode.class

distclean: clean
	$(ERASE) Makefile TAGS
	$(ERASE) *~

install: all install-nostrip install-docs install-api

install-nostrip: all
	$(MKDIR) $(exec_prefix)/bin
	cp $(EXECUTABLE) $(exec_prefix)/bin

install-strip: all
	$(MKDIR) $(exec_prefix)/bin
	$(STRIP) -o $(exec_prefix)/bin/$(EXECUTABLE) $(EXECUTABLE)

install-docs: all
	$(MKDIR) $(prefix)/man/man1
	cp $(srcdir)/../doc/jikes.1 $(prefix)/man/man1

install-api:
	$(MKDIR) $(prefix)/include
	cp jikesapi.h $(prefix)/include

uninstall:
	$(ERASE) $(exec_prefix)/bin/$(EXECUTABLE)
	$(ERASE) $(prefix)/man/man1/jikes.1
	$(ERASE) $(prefix)/include/jikesapi.h

Makefile: $(srcdir)/Makefile.in
	cd $(top_srcdir); ./config.status

jikespg:
	cd $(srcdir)
	jikespg java.g
	$(ERASE) java.l

.SUFFIXES:
.SUFFIXES: .cpp .@OBJEXT@

.cpp.@OBJEXT@:
	$(CXX) $(CXXFLAGS) -c $< -o $@

# List all the files to be compiled here
OBJECTS=\
ast.@OBJEXT@ \
body.@OBJEXT@ \
bytecode.@OBJEXT@ \
case.@OBJEXT@ \
code.@OBJEXT@ \
control.@OBJEXT@ \
decl.@OBJEXT@ \
definite.@OBJEXT@ \
depend.@OBJEXT@ \
diagnose.@OBJEXT@ \
double.@OBJEXT@ \
dump.@OBJEXT@ \
error.@OBJEXT@ \
expr.@OBJEXT@ \
getclass.@OBJEXT@ \
incrmnt.@OBJEXT@ \
init.@OBJEXT@ \
javaact.@OBJEXT@ \
jikes.@OBJEXT@ \
jikesapi.@OBJEXT@ \
long.@OBJEXT@ \
lookup.@OBJEXT@ \
lpginput.@OBJEXT@ \
modifier.@OBJEXT@ \
op.@OBJEXT@ \
option.@OBJEXT@ \
parser.@OBJEXT@ \
scanner.@OBJEXT@ \
segment.@OBJEXT@ \
set.@OBJEXT@ \
stream.@OBJEXT@ \
symbol.@OBJEXT@ \
system.@OBJEXT@ \
tab.@OBJEXT@ \
unparse.@OBJEXT@ \
unzip.@OBJEXT@ \
zip.@OBJEXT@ \
platform.@OBJEXT@


# This declaration must appear AFTER the OBJECTS variable is defined
# otherwise $(OBJECTS) will be empty and no .o files will be made
$(EXECUTABLE): $(OBJECTS)
	$(CXX) -o $(EXECUTABLE) $(LDFLAGS) $(OBJECTS) $(LIBS)

